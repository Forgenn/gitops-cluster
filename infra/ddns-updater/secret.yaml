apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  # This is the name of the ExternalSecret resource itself
  name: porkbun-ddns-credentials
  namespace: cert-manager
spec:
  # This points to your configured secret store
  secretStoreRef:
    name: infisical-cluster-secret-store
    kind: ClusterSecretStore
  data:
    - secretKey: apiKey
      remoteRef:
        key: /porkbun/api-key # The path to your API key in Infisical
    - secretKey: secretApiKey
      remoteRef:
        key: /porkbun/secret-api-key # The path to your Secret API key in Infisical

  # This section defines the Kubernetes secret that will be created
  target:
    name: porkbun-ddns-credentials # Name of the Kubernetes secret to be created
    creationPolicy: Owner
    template:
      engineVersion: v2
      type: Opaque
      # The 'data' block of the Kubernetes secret will be generated from this template
      data:
        # The key in the final secret will be 'settings.json'
        # The value will be the multi-line JSON string below
        settings.json: |
          {
            "settings": [
              {
                "provider": "porkbun",
                "domain": "domain.com",
                "api_key": "{{ .apiKey | toString }}",
                "secret_api_key": "{{ .secretApiKey | toString }}",
                "ip_version": "ipv4",
                "ipv6_suffix": ""
              }
            ]
          }